<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
</head>
<body>
	<script src="https://unpkg.com/vue/dist/vue.js"></script>
	<script src="https://unpkg.com/vue-router/dist/vue-router.js"></script>
    <script src="http://img.mybjx.net/theme/default/js/common/jquery-1.6.min.js" type="text/javascript"></script>


	<div id="app">
	  <h1>Hello App!</h1>
	  <p>
	    <!-- 使用 router-link 组件来导航. -->
	    <!-- 通过传入 `to` 属性指定链接. -->
	    <!-- <router-link> 默认会被渲染成一个 `<a>` 标签 -->
	    <router-link to="/mnews/20151109/531436.shtml">Go to Foo</router-link>
	    <router-link to="/bar">Go to Bar</router-link>
	  </p>
	  <!-- 路由出口 -->
	  <!-- 路由匹配到的组件将渲染在这里 -->
      <keep-alive>
	  <router-view></router-view>
      </keep-alive>
	</div>
<script type="text/tpl" id="bar">
    <div>
	<ul>
	    <li v-for="item in list"><img v-bind:src="item.headImg | imgfilter" width="100" height="100"/><a v-on:click="viewnews(item.mhtml)">{{item.title}}</a></li>
	</ul>
	<p><a v-on:click="loadmore" style="cursor:pointer">点击加载更多</a></p>
	</div>
</script>

	<script type="text/javascript">
		/*$(document).ready(function () {
			$(window).scroll(function () {
				 if (( $(window).scrollTop()+50) >= ($(document).height() - $(window).height())) {
					 
					 console.log(Bar.loadmore)
				 }
			})
		})*/
		// 0. 如果使用模块化机制编程，導入Vue和VueRouter，要调用 vue.use(vuerouter)
        Vue.filter('listurlfilter', function (value) {
          // 返回处理后的值
		    return value.replace('http://m.bjx.com.cn','')
         })
		 
		 Vue.filter('imgfilter', function (value) {
          // 返回处理后的值
		    return value?"http://img.bimg.126.net/photo/DCi7Q__VN3NJ_63cq7sosA==/3439905690381537164.jpg":"http://img4.imgtn.bdimg.com/it/u=3891867470,1602158220&fm=26&gp=0.jpg"
         })

		// 1. 定义（路由）组件。
		// 可以从其他文件 import 进来
		const Foo = { template: '<div>foo{{ $route.params.id }}<p><h1>{{title}}</h1></p><p v-html="content"></p></div>',
		             data:function(){
						     return {
								   title:'this is 啊 提提了',
								   content:''
								 }
						 },
		             mounted:function(){
						   var that=this
						   that.loaddata()
					  },
					  methods:{
						  loaddata:function(){
							      var that=this;
								  var tempid=that.$route.params.id;
								  var tempindate=that.$route.params.indata;
								  console.log(that.$route.params.indata)
								  console.log(that.$route.params.id)
								  crossDomainAjax("http://192.168.4.98:10020/V1/WebNews/GetNewsDetail?appid=web_dianli&tokon=03FF35418C55E3F590A1BA5B0AD683C7&timestamp=20170717151358&sign=", "newsid="+tempid+"&newsindate="+tempindate, function (result) {
         console.log(result.Data)
		 //console.log(result)
		 that.title=result.Data.title
		 that.content=result.Data.content

    });
							  }
						  }
		 }
		const Bar = { template: '#bar' ,
		       data:function(){
				      return {
						     list:[],
							 maxid:0,
							 minid:0,
							 catid:88,
							 isfirstload:true
						  }
				   },
		             mounted:function(){
						   var that=this
						   that.loaddata();
						  $(window).scroll(function () {
							   if (( $(window).scrollTop()+50) >= ($(document).height() - $(window).height())) {
								   that.loadmore()
							   }
						  })
					  },
					  methods:{
						  loaddata:function(){
							      var that=this;
								  crossDomainAjax("http://192.168.4.98:10020/V1/WebNews/GetNewsByCat?appid=web_dianli&tokon=03FF35418C55E3F590A1BA5B0AD683C7&timestamp=20170717151358&sign=", "cat="+that.catid+"&maxid="+that.maxid+"&minid="+that.minid+"&pageSize=10&isUp=1", function (result) {
         console.log(result.Data)
		 
		 that.maxid=result.Data[0].id
		 that.minid=result.Data[result.Data.length-1].id
		 
		 if (that.isfirstload)
		 {
			console.log(result.Data);
            that.list=result.Data
		 }
		 else
		 {
		      var llist=that.list;
			  that.list=llist.concat(result.Data)
			  console.log(that.list)	 
		 }
    });
							  },
							viewnews:function(url){
								  console.log(url)
								  var lurl=url.replace('http://m.bjx.com.cn','')
								  router.push(lurl)
								  return false;
								},
							loadmore:function(){
								   var that=this
								   that.isfirstload=false
								   that.loaddata()
								}
							  
						  }
		}


		// 2. 定义路由
		// 每个路由应该映射一个组件。 其中"component" 可以是
		// 通过 Vue.extend() 创建的组件构造器，
		// 或者，只是一个组件配置对象。
		const routes = [
		  { path: '/mnews/:indata/:id'+'.shtml', component: Foo },
		  { path: '/bar', component: Bar },
		]


		// 3. 创建 router 实例，然后传 `routes` 配置
		// 你还可以传别的配置参数, 不过先这么简单着吧。
		const router = new VueRouter({
		  routes // （缩写）相当于 routes: routes
		})


		// 4. 创建和挂载根实例。
		// 记得要通过 router 配置参数注入路由，
		// 从而让整个应用都有路由功能
		const app = new Vue({
		  router
		}).$mount('#app')

function crossDomainAjax(url, data, callBack) {
    $.ajax({
        url: url,
        type: "POST",	
        data: data,
	   // contentType: "application/x-www-form-urlencoded",
		//beforeSend: function (xhr) {
		// //发送ajax请求之前向http的head里面加入验证信息
		//xhr.setRequestHeader("appid", "web_dianli"); // 请求发起前在头部附加token
		//},
		//headers:{"appid":"web_dianli","Content-Type":"application/x-www-form-urlencoded")},
        dataType: "json",
        async: false,
        crossDomain: true,
        success: callBack
    });
}
		// 现在，应用已经启动了！
	</script>
</body>
</html>